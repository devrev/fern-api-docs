DevRev uses the concept of permissions to control access to records. 
Permissions are associated with users or groups and define the level of access they have to leaf types and their fields.
You can read more about permissions in the [DevRev documentation](https://devrev.ai/docs/product/access-control).

## Article permissions

{/* TODO: more on article permissions */}
Articles can be shared with users or groups. 

The `shared_with` field allows to specify the permission level for each user or group using the `permission` type. 
The `permission` type is a special structure associating a reference to an user-like record type (the field `member_id`)
with an `enum` value that provides the user with the role or permission level.

## Groups

To make the groups available in the DevRev platform, Airdrop expects two objects:

1. An object that contains the descriptions of the groups that are available in the external system.
    - This object should be mapped to the `group` object in DevRev.
2. An object that contains a 1:1 mapping between the groups and the users in the external system.
    - This object should be mapped to the `object_member` object in DevRev.

## Platform groups

Platform groups are groups automatically created by the DevRev platform for every organization. 
For example, DevRev provides *Dev users* and *Rev users* groups that contain all the Dev and Rev users respectively.

We allow developers to map their external default groups to platform groups. 
This functionality allows for flexible integration with the platform's permission system while allowing for re-mapping by the end user.

To implement this mapping, developers need to define a new object in external metadata with one enum field containing the possible values of default groups available in the external system. During the initial domain mapping, developers can map this object to the *platform groups* object in DevRev. The platform groups object can then be referenced in other objects, such as in the `shared_with` field of articles.

## Authorization policy

The *Authorization policy* object translates permission structures from an external system into DevRev's access control model. It enables the import of external roles and their associated permissions, automatically creating corresponding Roles, Role Sets, and Access Control Entries (ACEs) within DevRev. This allows defining CRUD (Create, Read, Update, Delete) permissions for specific record types, applying them to users and groups.

<Info>
Currently, only 1-way sync (from the external system to DevRev) is supported for the authorization policy.
</Info>

### Object fields

The Authorization policy object supports the following fields:

- `groups`: A list of group identifiers from the external system to which this policy applies.
- `users`: A list of user identifiers from the external system to which this policy applies.
- `targets`: Defines the DevRev record types the permissions apply to. The format differs between metadata definition and runtime import.
- `privileges`: Specifies the permissions granted by the policy. These should be normalized to CRUD operations.

### Defining `targets` and `privileges`

The representation of `targets` and `privileges` varies depending on the context: defining the external domain metadata versus importing data at runtime.

<Tabs>
<Tab title="External domain metadata">

When defining the external domain metadata for your Airdrop integration:

**`targets` field:**

Specify a list of strings representing the record types or record type categories the policy applies to.
- Use the prefix `#record:` for specific record types (e.g., `#record:document`).
- Use the prefix `#category:` for record type categories (e.g., `#category:users`).

```json title="Example: Metadata targets field"
targets: ["#record:document", "#category:users"]
```

**`privileges` field:**

Define an `enum` field representing the distinct permission levels available in the external system. You should normalize these external permissions to their closest CRUD equivalents (create, read, update, delete).

During the initial domain mapping setup, you will map these enum values to DevRev's standard CRUD permissions. End users can later customize this mapping if needed.


<Warning>
Authorization policies should always be the snapshot of the current state of the external system. In each sync run, the entire policy should be recreated or not provided at all.

The object has to be marked as `is_snapshot` to indicate that it should be the snapshot of the current state of the external system.
</Warning>

</Tab>
<Tab title="Runtime import">

During the data import process at runtime:

**`targets` field:**

Provide an array of strings containing the actual DevRev record type names. If a category was specified in the metadata (e.g., `#category:users`), it should be expanded into the list of all record types belonging to that category at runtime.

For example, if the `#category:users` includes "executives" and "developers", the runtime targets field should be:
```json
["document", "executives", "developers"]
```

**`privileges` field:**

Provide an array of strings representing the specific CRUD permissions granted by the policy, based on the mapping defined during domain setup (or as re-mapped by the user).

For example, if the external role granted read and update access, the runtime privileges field should be:
```json
["read", "update"]
```

</Tab>
</Tabs>




