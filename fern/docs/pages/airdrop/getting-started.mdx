## Before you begin

### Create a new organization

If this is your first time setting up an organization within DevRev, you need to create a dedicated DevRev organization for developing your new Airdrop snap-in:

1. Click on your profile picture in the top left corner.
2. Go to the **Orgs** section and click on **+**.
3. Fill in the necessary details and click **Create**.

You now find your newly created organization under **Orgs**.

## Local development

For ease of development, you can run your snap-in locally and receive logs directly in your console.

### Prerequisites

- [devrev-cli](https://developer.devrev.ai/snapin-development/references/cli-install) (version 4.7 or higher)
- [jq](https://stedolan.github.io/jq)
- [golang](https://go.dev/doc/install)
- [nodejs](https://nodejs.org/en/download/package-manager) (version 18.x.x+ or higher)
- [ngrok](https://ngrok.com)

### Starter template

DevRev provides a template with example code to implement an Airdrop as a Service (ADaaS) snap-in.

1. Create a new repository:
   - Create a new repository from this template by clicking the "Use this template" button in the upper right corner and then "Create a new repository".
   - The repository name must start with `airdrop-` (for example, `airdrop-<external system>-snap-in`).
2. Open the project in your IDE and authenticate to your DevRev organization using the DevRev CLI:
   ```bash
   devrev profiles authenticate --org <your DevRev organization slug>
   ```
3. Install the snap-in dependencies from the `code` directory:
   ```bash
   npm ci
   ```
4. Start the snap-in development server from the `code` directory:
   ```bash
   npm run test:server -- local
   ```
   This will start the snap-in server on `http://localhost:8000`.
5. Start the ngrok tunnel in a separate terminal window:
   ```bash
   ngrok http 8000
   ```
   This will create a tunnel to your local server.
   The ngrok forwarding URL will be displayed in the terminal window.
6. Copy the ngrok forwarding URL and create a new snap-in version and snap-in package using the DevRev CLI:
   ```bash
   devrev snap_in_version create-one  --manifest ./manifest.yaml --create-package --testing-url <ngrok forwarding URL>
   ```
7. Create a snap-in draft using the DevRev CLI:
   ```bash
   devrev snap_in draft
   ```
8. After the snap-in draft is created, install the snap-in:
   ```bash
   devrev snap_in activate
   ```
9. Start the import (**Airdrops** -> **Start Airdrop** -> **Your snap-in**).

## Snap-in code structure

A snap-in is a Node.js project with a specific file structure:

```
- manifest.yaml
- code/
  - scripts/
  - src/
    - fixtures/
    - functions/
      - external-system/
      - extraction/
        - workers/
          - attachments-extraction.ts
          - data-extraction.ts
          - external-sync-units-extraction.ts
          - metadata-extraction.ts
        - index.ts
      - install_initial_domain_mapping/
      - loading/
        - workers/
          - load-data.ts
          - data-extraction.ts
          - external-sync-units-extraction.ts
          - metadata-extraction.ts
        - index.ts
    - test-runner/
  - test/
```

The `manifest.yaml` file plays a critical role in a snap-in, holding key configuration details such as the snap-in's name, description, version, connection information, and functionality specifics. This file is the initial step in the development of a snap-in.

The `code/` folder holds the implementation of the snap-in. Inside, the `functions/` subfolder includes the logic for retrieving external sync units, extracting data from and loading data to external systems, and mapping between them.

The `scripts/` folder contains the scripts necessary for the building and deployment of the snap-in, streamlining the development and deployment processes with the help of tools like `deploy.sh` and `build.sh`.
