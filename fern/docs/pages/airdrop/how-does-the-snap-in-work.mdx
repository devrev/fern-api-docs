## What happens during an airdrop

### From the UI perspective

1. Starting an airdrop begins with establishing a connection to the external system. The snap-in prompts for specific information needed to create this connection. Afterwards, the snap-in verifies that the connection is successful and you should see a success message.

2. Once the connection is established, the snap-in collects information from the external system about the data unit to be exported. This phase is called _external sync units extraction_. An external sync unit is the data unit from the external system to be imported to DevRev. At this point, the UI prompts the user to select an external sync unit from the list.

3. The snap-in then extracts data from the external system.

4. Afterwards, the UI requests the mapping of data from the external system to DevRev. The user can decide which fields from each system should match.

5. Once mapping is complete, the snap-in saves the data to DevRev.

6. Finally, the snap-in streams any possible attachments from the external system to DevRev.

The process described above is known as the initial sync. In all subsequent syncs, the first two steps are skipped.

### In the background

The snap-in constantly communicates with Airdrop, which manages its behavior. When an action occurs in the UI, Airdrop sends a message to the snap-in with details about the event. The snap-in performs an action based on the event type. For example, when a user starts a new airdrop for the first time, Airdrop instructs the snap-in to perform an external sync unit extraction. The snap-in carries out the task and sends back available sync units to Airdrop.

## Snap-in code structure

A snap-in is a Node.js project with a specific structure:

```
- manifest.yaml
- code/
  - scripts/
  - src/
    - fixtures/
    - functions/
      - external-system/
      - extraction/
        - workers/
          - attachments-extraction.ts
          - data-extraction.ts
          - external-sync-units-extraction.ts
          - metadata-extraction.ts
        - index.ts
      - install_initial_domain_mapping/
      - loading/
        - workers/
          - load-data.ts
          - data-extraction.ts
          - external-sync-units-extraction.ts
          - metadata-extraction.ts
        - index.ts
    - test-runner/
  - test/
```

The `manifest.yaml` file is crucial in a snap-in as it contains the configuration details, including the snap-in's name, description, version, connection info, and functionality details. It serves as the starting point for snap-in development.

The `code/` folder houses the snap-in implementation. The functions/ directory is where the core logic resides, with the extraction folder handling data extraction from external systems and the loading folder managing data loading into DevRev.

The `scripts/` folder contains scripts for building and deploying the snap-in.
