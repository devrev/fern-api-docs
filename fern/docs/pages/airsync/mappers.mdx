Mappers are a core component of AirSync that manage and track the relationships between items imported from external systems and their corresponding entities in DevRev. Think of Mappers as a comprehensive lookup table that maintains the synchronization state between external and DevRev objects.

## When to use Mappers

Mappers are essential in several AirSync scenarios:

**During data extraction** - Check if items already exist to avoid duplicates, find related DevRev entities for nested objects like comments and attachments, and verify sync status.

```typescript
// Check if attachment already exists
const existingMapping = await adapter.mappers.getByExternalId({
  sync_unit: syncUnit,
  external_id: attachment.id,
  target_type: SyncMapperRecordTargetType.ARTIFACT,
});
```

**During loading operations** - Locate external IDs for DevRev entities when pushing data back to external systems and maintain consistency between systems.

```typescript
// Find external ID to update external system
const mapping = await adapter.mappers.getByTargetId({
  sync_unit: syncUnit,
  target: devrevWorkId,
});
```

**For relationship management** - Link child objects to their parent entities and maintain hierarchical relationships across systems.

```typescript
// Find parent work item for comment
const parentMapping = await adapter.mappers.getByExternalId({
  sync_unit: syncUnit,
  external_id: externalComment.ticket_id,
  target_type: SyncMapperRecordTargetType.WORK,
});
```

## How to access Mappers

Mappers are available through the adapter object as `adapter.mappers` in your AirSync snap-in functions.

## Mapper methods

### Retrieve by DevRev ID

Use `getByTargetId` when you have a DevRev entity ID and need to find the corresponding external system ID:

```typescript
const response = await adapter.mappers.getByTargetId({
  sync_unit: syncUnitId,
  target: devrevEntityId,
});

const externalIds = response.data.sync_mapper_record.external_ids;
```

### Retrieve by external ID

Use `getByExternalId` when you have an external system ID and need to find the corresponding DevRev entity:

```typescript
const response = await adapter.mappers.getByExternalId({
  sync_unit: syncUnitId,
  external_id: externalSystemId,
  target_type: SyncMapperRecordTargetType.WORK,
});

const devrevTargets = response.data.sync_mapper_record.targets;
```

### Create new mapping

Use `create` to establish a new relationship between external and DevRev entities:

```typescript
const response = await adapter.mappers.create({
  sync_unit: syncUnitId,
  external_ids: [externalSystemId],
  targets: [devrevEntityId],
  status: SyncMapperRecordStatus.OPERATIONAL,
});
```

### Update existing mapping

Use `update` to modify an existing mapping record:

```typescript
const response = await adapter.mappers.update({
  id: mappingRecordId,
  sync_unit: syncUnitId,
  external_ids: {
    add: [newExternalId],
  },
  targets: {
    add: [newDevrevEntityId],
  },
  status: SyncMapperRecordStatus.OPERATIONAL,
});
```
