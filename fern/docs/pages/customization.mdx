<Callout intent="warning">
This functionality is in Beta. It is not recommended for use in production applications.
</Callout>

DevRev's customization framework offers the ability to customize DevRev objects to your
organization's needs. Extend entities in your DevRev workspace by adding new custom
fields or defining new categorizations of the existing objects.

## Glossary

1. **Leaf type**: A DevRev object type. For example, _issue_, _ticket_.
1. **Subtype**: A categorization of a leaf type. For example, _incident_ can be a subtype of _issue_.
1. **Schema fragment**: A schema fragment defines the schema for an object.

## Concepts

### Tenant custom fields

Use tenant custom fields to extend a DevRev object type with new fields that apply to all records of the object type in your application workspace.

### Subtypes

Subtypes categorize DevRev object types. For instance, you can make an "Incident"
subtype for the "Ticket" leaf type. This subtype keeps all fields from the original type
and adds new ones specific to the subtype.

### Schema fragments

DevRev objects are customized using "schema fragments". These fragments are the building
blocks that define specific sets of custom fields. When creating or updating an object
record, multiple schema fragments can be combined to determine the full set of custom
fields available for that record. The term "fragment" is used because each schema
fragment contributes a portion of the overall object schema.

Multiple object records can reference the same schema fragment.

## Customizing a DevRev object
Let's say you want to manage incidents across various environments (Dev, QA, Prod) in
your organization. This guide goes through the process of creating a subtype called
"Incident" for the "Issue" leaf type.

First, create a schema fragment for the subtype.

```curl maxLines=10
curl --location 'https://api.devrev.ai/schemas.custom.set' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: <TOKEN>' \
--data '{
    "type": "custom_type_fragment",
    "description": "Attributes for tracking an incident",
    "leaf_type": "issue",
    "subtype": "Incident",
    "fields": [
        {
            "name": "regression",
            "field_type": "enum",
            "allowed_values": [ "Yes", "No" ],
            "is_filterable": true,
            "is_required": true,
            "default_value": "No",
            "ui": {
                "display_name": "Regression",
            }
        },
        {
            "name": "impacted_environments",
            "field_type": "array",
            "base_type": "enum",
            "allowed_values": [ "Dev", "QA", "Prod" ],
            "is_filterable": true,
            "ui": {
                "display_name": "Impacted Environments",
            }
        },
        {
            "name": "pia",
            "field_type": "rich_text",
            "ui": {
                "display_name": "PIA",
            }
        },
    ]
}'
```

Let's say there was an incident in the Prod environment. The developer working on the
mitigation can create an issue object using the subtype to track the incident.

```curl
curl --location 'https://api.devrev.ai/works.create' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: <TOKEN>' \
--data '{
    "type": "issue",
    "title": "API failure in Prod",

    ... // other required fields

    "custom_schema_spec": {
        "subtype": "Incident"
    },
    "custom_fields": {
        "ctype__regression": "Yes",
        "ctype__impacted_environments": [ "Prod" ]
    }
}'
```

To add release notes for completed work, you can create a tenant custom field for the
issue object type. This enables developers to include release notes directly in the
issue objects that represent their work. Since release notes are relevant to all issues,
we'll use a tenant custom field rather than a subtype-specific field.

Here's how to add this custom field:

```curl
curl --location 'https://api.devrev.ai/schemas.custom.set' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: <TOKEN>' \
--data '{
    "type": "tenant_fragment",
    "description": "Tenant attributes for issues",
    "leaf_type": "issue",
    "fields": [
        {
            "name": "release_notes",
            "field_type": "rich_text",
            "ui": {
                "display_name": "Release Notes",
            }
        }
    ]
}'
```

After resolving the incident, developers can update the issue object with release notes.
This allows for tracking the specific changes or fixes that were implemented to address
the incident. Adding release notes provides a clear record of what was deployed to
resolve the issue, which can be valuable for future reference and communication with
stakeholders.

```curl
curl --location 'https://api.devrev.ai/works.update' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--header 'Authorization: <TOKEN>' \
--data '{
    "id": "don:core:dvrv-us-1:devo/11FVC3ScK:issue/1",
    "type": "issue",
    "custom_schema_spec": {
        "tenant_fragment": true
    },
    "custom_fields": {
        "tnt__release_notes": "<RELEASE_NOTES>"
    }
}'
```

The final issue object now looks like this:
```json
{
    "id": "don:core:dvrv-us-1:devo/11FVC3ScK:issue/1",
    "type": "issue",
    "title": "API failure in Prod",
    "display_id": "ISS-1",
    "created_by": {...},
    "created_date": "2024-10-11T06:48:57.759Z",
    "custom_fields": {
        "ctype__regression": "Yes",
        "ctype__impacted_environments": [ "Prod" ],
        "tnt__release_notes": "<RELEASE_NOTES>"
    },
    "subtype": "Incident",
    "custom_schema_fragments": [
        "don:core:dvrv-us-1:devo/11FVC3ScK:tenant_fragment/1",
        "don:core:dvrv-us-1:devo/11FVC3ScK:custom_type_fragment/1"
    ]
}
```

Note that fields defined by different schema fragments are held in different namespaces
in an object. Stock fields, subtype fields, and tenant custom fields live in their
respective namespaces to prevent field name conflicts. Specifically:

1. Names for tenant custom fields are in the form `tnt__<name>`.
2. Names for subtype custom fields are of the form `ctype__<name>`.

References to each fragment describing the object fields are stored with the object. An
object can contain references to a subtype fragment and a tenant fragment.

## Supported custom field types

The following custom field types are supported -

| Type      | Example                                  |
| --------- | ---------------------------------------- |
| int       | `42`                                     |
| double    | `3.14`                                   |
| bool      | `true`                                   |
| tokens    | `"apple"`, `"orange"`                    |
| text      | `"Hello, world!"`                        |
| rich_text | `"**Hello**, world!"`                    |
| enum      | `"red"`                                  |
| timestamp | `"2020-10-20T00:00:00Z"` (RFC3339)       |
| date      | `"2020-10-20"` (YYYY-MM-DD)              |
| id        | `"don:core:dvrv-us-1:devo/test:issue/1"` |

The list variants of all the supported custom field types are also supported (`[]tokens`, `[]text`, etc).

## Schema fragment versioning
Custom schema fragments are immutable, and thus updating a fragment means creating a new one.

Two older objects (1 and 2) and one newer object referencing different fragment versions.

![customization2](../img/customization2.png)

### Deprecating a custom schema fragment

Custom schema fragments can be marked as deprecated to avoid creating work items with them. The following POST request payload can be used for the same.

```json {9}
{
    "type": "custom_type_fragment",
    "description": "Attributes for tracking an incident",
    "leaf_type": "ticket",
    "subtype": "Incident",
    "fields": [
        ...
    ],
    "deprecated": true,
}
```

### Listing custom schema fragments

To verify the result of the above API invocation, you can [list the custom schema fragments](https://devrev.ai/docs/apis/beta-api-spec#/operations/custom-schema-fragments-list) in the org:

```curl
curl --location 'https://api.devrev.ai/schemas.custom.list' \
--header 'Accept: application/json' \
--header 'Authorization: <TOKEN>'
```

Deprecated fragments aren't returned when listing custom schema fragments.
