This section describes the process of integrating the DevRev SDK with your React Native Expo app.

## Prerequisites

Ensure you have the following installed:
- `expo` (any version)
- `react-native` (compatible with Expo version)
- `@devrev/sdk-react-native` (version 1.0.2 or higher)

## Installation

1. Install the Expo config plugin:
```bash
npx expo install @devrev/sdk-react-native-expo-plugin
```

2. Configure the plugin in your `app.json` or `app.config.js`:
```json
{
  "expo": {
    "plugins": [
      "@devrev/sdk-react-native-expo-plugin"
    ]
  }
}
```

3. Rebuild your app:
```bash
npx expo prebuild --clean
```

## Setting up the DevRev SDK

### Step 1: Credentials

1. Open the DevRev web app at [https://app.devrev.ai](https://app.devrev.ai).
2. Navigate to the **Settings** page.
3. Open the **PLuG Settings** page and copy the value under **Your Unique App ID**.

### Step 2: Configuration

<Callout intent="note">
The SDK must be configured before you can use any of its features.
</Callout>

Once you have the credentials, configure the DevRev SDK in your app. The SDK will be ready to use after calling the configuration method:

```typescript
DevRevSDK.configure(appID: string)
```

## Features

### Identification

Certain features of the DevRev SDK require user identification. You can identify users in the following ways:
- **Anonymous users**: Creates an anonymous user with an optional user identifier.
- **Unverified users**: Identifies the user with a unique identifier but does not verify the user's identity with the DevRev backend.
- **Verified users**: Identifies the user with a unique identifier and verifies their identity with the DevRev backend.

The identification functions should be placed appropriately in your app after the user logs in. If you have the user information at app launch, call the function after the `DevRevSDK.configure(appID:)` method.

<Callout intent="note">
If you haven't previously identified the user, the DevRev SDK will automatically create an anonymous user for you immediately after the SDK is configured.
</Callout>

<Callout intent="note">
The `Identity` structure allows for custom fields in the user, organization, and account traits. These fields must be configured through the DevRev app before they can be utilized. For more information, refer to [Object customization](https://devrev.ai/docs/product/object-customization).
</Callout>

#### Anonymous identification

The anonymous identification method creates an anonymous user with an optional user identifier.

```typescript
DevRevSDK.identifyAnonymousUser(userID: string)
```

#### Unverified identification

The unverified identification method identifies the user with a unique identifier but does not verify their identity with the DevRev backend.

```typescript
DevRevSDK.identifyUnverifiedUser(userID: string, organizationID?: string)
```

#### Verified identification

The verified identification method identifies the user with a unique identifier and verifies their identity with the DevRev backend.

```typescript
DevRevSDK.identifyVerifiedUser(userID: string, sessionToken: string)
```

#### Updating the user

You can update the user's information using the following method:

```typescript
DevRevSDK.updateUser(identity: Identity)
```

<Callout intent="note">
The `userID` property cannot be updated.
</Callout>

### PLuG support chat

The support chat feature can be shown as a modal screen from the top-most screen.

<Callout intent="note">
This feature requires the SDK to be configured and the user to be identified (unverified or anonymous users).
</Callout>

```typescript
DevRevSDK.showSupport()
```

#### Creating a new support conversation

You can create a new conversation directly from your app. This method displays the support chat screen and simultaneously creates a new conversation.

```typescript
DevRevSDK.createSupportConversation()
```

## In-app link handling

The DevRev SDK provides a mechanism to handle links opened from within any screen that is part of the DevRev SDK.

You can fully customize the link handling behavior by setting the specialized in-app link handler. That way you can decide what should happen when a link is opened from within the app.

<Callout intent="note">
This feature is for Android only.
</Callout>

```typescript
DevRevSDK.setInAppLinkHandler((url) => {
	// Perform an action here.
});
```

You can further customize the behavior by setting the `setShouldDismissModalsOnOpenLink` boolean flag. This flag controls whether the DevRev SDK should dismiss the top-most modal screen when a link is opened.

```typescript
DevRevSDK.setShouldDismissModalsOnOpenLink(value: boolean)
```

### Analytics

The DevRev SDK supports sending custom analytic events using a properties map.

<Callout intent="note">
This feature requires the SDK to be configured and the user to be identified (unverified or anonymous users).
</Callout>

```typescript
DevRevSDK.trackEvent(name: string, properties?: Map<string, string>)
```

### Observability

The DevRev SDK provides observability features to help you understand how users interact with your app.

#### Opting in/out

Observability features are opted-in by default. You can opt-out by calling the following method:

```typescript
DevRevSDK.stopAllMonitoring()
```

To opt back in, use the following method:

```typescript
DevRevSDK.resumeAllMonitoring()
```

#### Session recording

You can enable session recording to capture user interactions with your app.

<Callout intent="note">
The session recording feature is opt-out and is enabled by default.
</Callout>

The session recording feature includes the following methods:

- `DevRevSDK.startRecording()`: Starts the session recording.
- `DevRevSDK.stopRecording()`: Stops the session recording and uploads it to the portal.
- `DevRevSDK.pauseRecording()`: Pauses the ongoing session recording.
- `DevRevSDK.resumeRecording()`: Resumes a paused session recording.
- `DevRevSDK.processAllOnDemandSessions()`: Stops the ongoing session recording and uploads all offline sessions on demand.

#### Session properties

You can add custom properties to the session recording to help you understand the context of the session. The properties are defined as a map of string values.

```typescript
DevRevSDK.addSessionProperties(properties: Map<string, string>)
```

To clear the session properties, use the following method:

```typescript
DevRevSDK.clearSessionProperties()
```

#### Masking sensitive data

To protect sensitive data, the DevRev SDK provides an auto-masking feature that masks data before sending it to the server. Input views such as text fields, text views, and web views are automatically masked.

You can manually mark additional views as sensitive using the following method:

```typescript
DevRevSDK.markSensitiveViews(tags: any[])
```

If any previously masked views need to be unmasked, use the following method:

```typescript
DevRevSDK.unmarkSensitiveViews(tags: any[])
```

#### Timers

The DevRev SDK provides a timer mechanism to measure the time spent on specific tasks. Events such as response time, loading time, or any other time-based event can be measured using the timer.

To start a timer, use the following method:

```typescript
DevRevSDK.startTimer(name: string, properties: Map<string, string>)
```

To stop a timer, use the following method:

```typescript
DevRevSDK.stopTimer(name: string, properties: Map<string, string>)
```

#### Screen tracking

The DevRev SDK provides automatic screen tracking to help you understand how users navigate through your app. You can also manually track screens using the following method:

```typescript
DevRevSDK.trackScreen(name: string)
```

### Push notifications

You can configure your app to receive push notifications from the DevRev SDK. The SDK is designed to handle push notifications and execute actions based on the notification's content.

#### Configuration

To receive push notifications, configure your DevRev organization by following the [Push Notifications integration guide](#).

#### Registering for push notifications

<Callout intent="note">
Push notifications require the SDK to be configured and the user to be identified (unverified or anonymous users).
</Callout>

Register your device for receiving push notifications using the following method:

```typescript
DevRevSDK.registerDeviceToken(deviceToken: string, deviceID: string)
```

#### Unregistering from push notifications

If your app no longer needs to receive push notifications, unregister the device using the following method:

```typescript
DevRevSDK.unregisterDevice(deviceID: string)
```

#### Processing push notifications

##### Android

To handle notification clicks, intercept the click event, extract the payload, and pass it to the following method:

```typescript
DevRevSDK.processPushNotification(payload: string)
```

###### Example

```typescript
const notificationPayload = {
	"message": {
		"title": "New Message",
		"body": "You have received a new message.",
		"data": {
			"messageId": "12345",
			"sender": "John Doe"
		}
	}
};

const messageJson = notificationPayload["message"];
DevRevSDK.processPushNotification(JSON.stringify(messageJson));
```

##### iOS

On iOS devices, pass the received push notification payload to the SDK for processing:

```typescript
DevRevSDK.processPushNotification(payload: string)
```

###### Example

```typescript
DevRevSDK.processPushNotification(JSON.stringify(payload));
```
